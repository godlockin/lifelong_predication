/**
 * 纳音五行模块
 * 
 * 六十甲子纳音
 */

// 六十甲子纳音表
export const NAYIN_TABLE = {
    '甲子': '海中金', '乙丑': '海中金',
    '丙寅': '炉中火', '丁卯': '炉中火',
    '戊辰': '大林木', '己巳': '大林木',
    '庚午': '路旁土', '辛未': '路旁土',
    '壬申': '剑锋金', '癸酉': '剑锋金',
    '甲戌': '山头火', '乙亥': '山头火',
    '丙子': '涧下水', '丁丑': '涧下水',
    '戊寅': '城头土', '己卯': '城头土',
    '庚辰': '白蜡金', '辛巳': '白蜡金',
    '壬午': '杨柳木', '癸未': '杨柳木',
    '甲申': '泉中水', '乙酉': '泉中水',
    '丙戌': '屋上土', '丁亥': '屋上土',
    '戊子': '霹雳火', '己丑': '霹雳火',
    '庚寅': '松柏木', '辛卯': '松柏木',
    '壬辰': '长流水', '癸巳': '长流水',
    '甲午': '砂石金', '乙未': '砂石金',
    '丙申': '山下火', '丁酉': '山下火',
    '戊戌': '平地木', '己亥': '平地木',
    '庚子': '壁上土', '辛丑': '壁上土',
    '壬寅': '金箔金', '癸卯': '金箔金',
    '甲辰': '覆灯火', '乙巳': '覆灯火',
    '丙午': '天河水', '丁未': '天河水',
    '戊申': '大驿土', '己酉': '大驿土',
    '庚戌': '钗钏金', '辛亥': '钗钏金',
    '壬子': '桑柘木', '癸丑': '桑柘木',
    '甲寅': '大溪水', '乙卯': '大溪水',
    '丙辰': '沙中土', '丁巳': '沙中土',
    '戊午': '天上火', '己未': '天上火',
    '庚申': '石榴木', '辛酉': '石榴木',
    '壬戌': '大海水', '癸亥': '大海水'
};

// 纳音五行归类
export const NAYIN_ELEMENT = {
    '海中金': '金', '剑锋金': '金', '白蜡金': '金',
    '砂石金': '金', '金箔金': '金', '钗钏金': '金',
    '炉中火': '火', '山头火': '火', '霹雳火': '火',
    '山下火': '火', '覆灯火': '火', '天上火': '火',
    '大林木': '木', '杨柳木': '木', '松柏木': '木',
    '平地木': '木', '桑柘木': '木', '石榴木': '木',
    '路旁土': '土', '城头土': '土', '屋上土': '土',
    '壁上土': '土', '大驿土': '土', '沙中土': '土',
    '涧下水': '水', '泉中水': '水', '长流水': '水',
    '天河水': '水', '大溪水': '水', '大海水': '水'
};

// 纳音含义解读
export const NAYIN_MEANING = {
    '海中金': '金在海中，珠藏渊源，深藏不露，大富大贵之命',
    '炉中火': '火在炉中，冶炼万物，光明正大，事业有成之命',
    '大林木': '木成森林，庇荫众生，德才兼备，领袖之命',
    '路旁土': '土在路旁，默默奉献，勤劳朴实，稳健之命',
    '剑锋金': '金成利刃，锋芒毕露，刚直果断，将帅之命',
    '山头火': '火在山巅，光照四方，名扬四海，显贵之命',
    '涧下水': '水在山涧，清澈灵动，聪慧过人，文采之命',
    '城头土': '土成城墙，坚固稳定，守护一方，事业稳固之命',
    '白蜡金': '金质纯净，温润如玉，内敛沉稳，富贵之命',
    '杨柳木': '木质柔韧，随遇而安，灵活变通，适应力强之命',
    '泉中水': '水出泉眼，源源不断，财源广进，富裕之命',
    '屋上土': '土在屋上，遮风挡雨，庇护家人，居家安康之命',
    '霹雳火': '火如雷电，震惊四方，才华横溢，不凡之命',
    '松柏木': '木成松柏，四季常青，坚韧不拔，长寿之命',
    '长流水': '水流不息，源远流长，绵延不绝，福泽绵长之命',
    '砂石金': '金藏砂石，待时而发，厚积薄发，大器晚成之命',
    '山下火': '火在山下，温暖人间，慈悲为怀，德高望重之命',
    '平地木': '木生平地，易于生长，平稳发展，安乐之命',
    '壁上土': '土附墙壁，依附而生，需贵人相助之命',
    '金箔金': '金成薄箔，装点门面，外表光鲜，需实力支撑之命',
    '覆灯火': '火如灯明，照亮人生，智慧光明，启迪之命',
    '天河水': '水从天降，恩泽万物，福禄双全，贵人之命',
    '大驿土': '土成大道，四通八达，人脉广泛，社交之命',
    '钗钏金': '金成饰物，精致美丽，品味高雅，艺术之命',
    '桑柘木': '木可养蚕，勤劳致富，实干兴家，务实之命',
    '大溪水': '水成溪流，滋润万物，慷慨助人，善良之命',
    '沙中土': '土在沙中，需努力挖掘，潜力待发，努力之命',
    '天上火': '火在天际，光芒万丈，志向高远，成就非凡之命',
    '石榴木': '木结硕果，子孙繁茂，多子多福，昌盛之命',
    '大海水': '水成大海，包容万物，胸怀宽广，王者之命'
};

/**
 * 获取干支的纳音
 * @param {string} ganzhi - 干支（如"甲子"）
 * @returns {string|null} 纳音
 */
export function getNayin(ganzhi) {
    return NAYIN_TABLE[ganzhi] || null;
}

/**
 * 获取纳音的五行属性
 * @param {string} nayin - 纳音
 * @returns {string|null} 五行
 */
export function getNayinElement(nayin) {
    return NAYIN_ELEMENT[nayin] || null;
}

/**
 * 分析八字纳音
 * @param {Object} bazi - 八字对象
 * @returns {Object} 纳音分析结果
 */
export function analyzeNayin(bazi) {
    const pillars = ['yearPillar', 'monthPillar', 'dayPillar', 'hourPillar'];
    const names = ['年柱', '月柱', '日柱', '时柱'];

    const nayinData = pillars.map((pillar, i) => {
        const ganzhi = bazi[pillar].ganzhi;
        const nayin = getNayin(ganzhi);
        const element = getNayinElement(nayin);
        const meaning = NAYIN_MEANING[nayin];

        return {
            pillar: names[i],
            ganzhi,
            nayin,
            element,
            meaning
        };
    });

    // 日柱纳音最重要
    const mainNayin = nayinData[2];

    return {
        data: nayinData,
        mainNayin: mainNayin.nayin,
        mainElement: mainNayin.element,
        mainMeaning: mainNayin.meaning,
        summary: `日柱${mainNayin.ganzhi}，纳音${mainNayin.nayin}，属${mainNayin.element}，${mainNayin.meaning}`
    };
}
