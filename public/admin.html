<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜åå° - å‘½ç†æµ‹ç®—ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ç™»å½•ç•Œé¢ */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-card h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .input-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 239, 125, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            font-size: 14px;
        }

        /* ä¸»ç•Œé¢ */
        .admin-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-header h1 {
            color: #667eea;
            font-size: 28px;
        }

        .logout-btn {
            background: rgba(235, 51, 73, 0.1);
            color: #eb3349;
            padding: 10px 25px;
            border: 2px solid #eb3349;
        }

        .logout-btn:hover {
            background: #eb3349;
            color: white;
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .tab {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: none;
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #666;
        }

        .tab:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .generate-section {
            display: flex;
            gap: 15px;
            align-items: flex-end;
            margin-bottom: 30px;
        }

        .generate-section .input-group {
            flex: 1;
            margin-bottom: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        table tbody tr {
            transition: all 0.3s;
        }

        table tbody tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(56, 239, 125, 0.2);
            color: #11998e;
        }

        .status-inactive {
            background: rgba(235, 51, 73, 0.2);
            color: #eb3349;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        .pagination button {
            padding: 8px 15px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .pagination button:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .pagination .page-info {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            color: white;
            font-weight: 600;
        }

        .hidden {
            display: none !important;
        }

        .error-message {
            background: rgba(235, 51, 73, 0.1);
            color: #eb3349;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #eb3349;
        }

        .success-message {
            background: rgba(56, 239, 125, 0.1);
            color: #11998e;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #11998e;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .code-display {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .code-item {
            background: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .detail-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            width: 100%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }

        .close-btn:hover {
            color: #eb3349;
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .detail-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .detail-section pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            overflow-x: auto;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .generate-section {
                flex-direction: column;
            }

            .admin-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            table {
                font-size: 14px;
            }

            table th,
            table td {
                padding: 10px 5px;
            }
        }
    </style>
</head>

<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginView" class="login-container">
        <div class="login-card">
            <h1>ğŸ”® ç®¡ç†å‘˜ç™»å½•</h1>
            <div class="input-group">
                <label for="passwordInput">ç®¡ç†å‘˜å¯†ç </label>
                <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
            </div>
            <div id="loginError" class="error-message hidden"></div>
            <button class="btn btn-primary" onclick="login()">ç™»å½•</button>
        </div>
    </div>

    <!-- ç®¡ç†ç•Œé¢ -->
    <div id="adminView" class="container hidden">
        <div class="admin-header">
            <h1>ğŸ”® å‘½ç†æµ‹ç®—ç³»ç»Ÿ - ç®¡ç†åå°</h1>
            <button class="btn logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('codes')">é‚€è¯·ç ç®¡ç†</button>
            <button class="tab" onclick="switchTab('records')">ç”¨æˆ·è®°å½•</button>
        </div>

        <!-- é‚€è¯·ç ç®¡ç† -->
        <div id="codesTab" class="tab-content active">
            <div class="card">
                <h2>ç”Ÿæˆé‚€è¯·ç </h2>
                <div class="generate-section">
                    <div class="input-group">
                        <label for="codeCount">ç”Ÿæˆæ•°é‡ (1-100)</label>
                        <input type="number" id="codeCount" min="1" max="100" value="5">
                    </div>
                    <div class="input-group">
                        <label for="codeNotes">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" id="codeNotes" placeholder="å¤‡æ³¨ä¿¡æ¯">
                    </div>
                    <button class="btn btn-success" onclick="generateCodes()">ç”Ÿæˆ</button>
                </div>
                <div id="generateResult"></div>
            </div>

            <div class="card">
                <h2>é‚€è¯·ç åˆ—è¡¨</h2>
                <div id="codesLoading" class="loading hidden">åŠ è½½ä¸­...</div>
                <div id="codesError" class="error-message hidden"></div>
                <div id="codesTable"></div>
                <div id="codesPagination" class="pagination"></div>
            </div>
        </div>

        <!-- ç”¨æˆ·è®°å½• -->
        <div id="recordsTab" class="tab-content">
            <div class="card">
                <h2>ç”¨æˆ·æäº¤è®°å½•</h2>
                <div id="recordsLoading" class="loading hidden">åŠ è½½ä¸­...</div>
                <div id="recordsError" class="error-message hidden"></div>
                <div id="recordsTable"></div>
                <div id="recordsPagination" class="pagination"></div>
            </div>
        </div>
    </div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="detailModal" class="detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>è®°å½•è¯¦æƒ…</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="detailContent"></div>
        </div>
    </div>

    <script>
        const API_BASE = '';  // ä½¿ç”¨ç›¸å¯¹è·¯å¾„
        let adminPassword = localStorage.getItem('adminPassword');
        let currentCodesPage = 0;
        let currentRecordsPage = 0;
        const pageSize = 20;

        // åˆå§‹åŒ–
        if (adminPassword) {
            showAdminView();
        }

        // ç™»å½•
        async function login() {
            const password = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('loginError');

            if (!password) {
                errorDiv.textContent = 'è¯·è¾“å…¥å¯†ç ';
                errorDiv.classList.remove('hidden');
                return;
            }

            // å°è¯•è·å–é‚€è¯·ç åˆ—è¡¨æ¥éªŒè¯å¯†ç 
            try {
                const response = await fetch(`${API_BASE}/admin/invitation-codes?limit=1`, {
                    headers: {
                        'X-Admin-Password': password
                    }
                });

                if (response.ok) {
                    localStorage.setItem('adminPassword', password);
                    adminPassword = password;
                    errorDiv.classList.add('hidden');
                    showAdminView();
                } else {
                    const data = await response.json();
                    errorDiv.textContent = data.error || 'å¯†ç é”™è¯¯';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                errorDiv.textContent = 'ç™»å½•å¤±è´¥: ' + error.message;
                errorDiv.classList.remove('hidden');
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('adminPassword');
            adminPassword = null;
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('adminView').classList.add('hidden');
        }

        // æ˜¾ç¤ºç®¡ç†ç•Œé¢
        function showAdminView() {
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('adminView').classList.remove('hidden');
            loadInvitationCodes();
        }

        // åˆ‡æ¢æ ‡ç­¾
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');

            if (tab === 'codes') {
                document.getElementById('codesTab').classList.add('active');
                loadInvitationCodes();
            } else if (tab === 'records') {
                document.getElementById('recordsTab').classList.add('active');
                loadRecords();
            }
        }

        // ç”Ÿæˆé‚€è¯·ç 
        async function generateCodes() {
            const count = parseInt(document.getElementById('codeCount').value);
            const notes = document.getElementById('codeNotes').value;
            const resultDiv = document.getElementById('generateResult');

            if (count < 1 || count > 100) {
                resultDiv.innerHTML = '<div class="error-message">ç”Ÿæˆæ•°é‡å¿…é¡»åœ¨ 1-100 ä¹‹é—´</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="loading">ç”Ÿæˆä¸­...</div>';

            try {
                const response = await fetch(`${API_BASE}/admin/invitation-codes`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Password': adminPassword
                    },
                    body: JSON.stringify({ count, notes: notes || null })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    let html = '<div class="success-message">';
                    html += `æˆåŠŸç”Ÿæˆ ${data.data.created} ä¸ªé‚€è¯·ç `;
                    if (data.data.failed > 0) {
                        html += `ï¼Œå¤±è´¥ ${data.data.failed} ä¸ª`;
                    }
                    html += '</div>';
                    html += '<div class="code-display">';
                    data.data.codes.forEach(code => {
                        html += `<div class="code-item">${code}</div>`;
                    });
                    html += '</div>';
                    resultDiv.innerHTML = html;

                    // åˆ·æ–°åˆ—è¡¨
                    loadInvitationCodes();
                } else {
                    resultDiv.innerHTML = `<div class="error-message">${data.error || 'ç”Ÿæˆå¤±è´¥'}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error-message">ç”Ÿæˆå¤±è´¥: ${error.message}</div>`;
            }
        }

        // åŠ è½½é‚€è¯·ç åˆ—è¡¨
        async function loadInvitationCodes(page = 0) {
            currentCodesPage = page;
            const loadingDiv = document.getElementById('codesLoading');
            const errorDiv = document.getElementById('codesError');
            const tableDiv = document.getElementById('codesTable');
            const paginationDiv = document.getElementById('codesPagination');

            loadingDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            tableDiv.innerHTML = '';
            paginationDiv.innerHTML = '';

            try {
                const offset = page * pageSize;
                const response = await fetch(`${API_BASE}/admin/invitation-codes?limit=${pageSize}&offset=${offset}`, {
                    headers: {
                        'X-Admin-Password': adminPassword
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    renderCodesTable(data.data, data.total);
                } else {
                    errorDiv.textContent = data.error || 'åŠ è½½å¤±è´¥';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                errorDiv.textContent = 'åŠ è½½å¤±è´¥: ' + error.message;
                errorDiv.classList.remove('hidden');
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        // æ¸²æŸ“é‚€è¯·ç è¡¨æ ¼
        function renderCodesTable(codes, total) {
            const tableDiv = document.getElementById('codesTable');
            const paginationDiv = document.getElementById('codesPagination');

            let html = '<table><thead><tr>';
            html += '<th>é‚€è¯·ç </th><th>åˆ›å»ºæ—¶é—´</th><th>ä½¿ç”¨æ¬¡æ•°</th><th>æœ€åä½¿ç”¨</th><th>çŠ¶æ€</th><th>å¤‡æ³¨</th>';
            html += '</tr></thead><tbody>';

            codes.forEach(code => {
                html += '<tr>';
                html += `<td><strong>${code.code}</strong></td>`;
                html += `<td>${new Date(code.created_at).toLocaleString('zh-CN')}</td>`;
                html += `<td>${code.used_count}</td>`;
                html += `<td>${code.last_used_at ? new Date(code.last_used_at).toLocaleString('zh-CN') : '-'}</td>`;
                html += `<td><span class="status-badge ${code.is_active ? 'status-active' : 'status-inactive'}">${code.is_active ? 'æ¿€æ´»' : 'ç¦ç”¨'}</span></td>`;
                html += `<td>${code.notes || '-'}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableDiv.innerHTML = html;

            // åˆ†é¡µ
            const totalPages = Math.ceil(total / pageSize);
            paginationDiv.innerHTML = `
                <button ${currentCodesPage === 0 ? 'disabled' : ''} onclick="loadInvitationCodes(${currentCodesPage - 1})">ä¸Šä¸€é¡µ</button>
                <div class="page-info">ç¬¬ ${currentCodesPage + 1} é¡µ / å…± ${totalPages} é¡µ (æ€»è®¡ ${total} æ¡)</div>
                <button ${currentCodesPage >= totalPages - 1 ? 'disabled' : ''} onclick="loadInvitationCodes(${currentCodesPage + 1})">ä¸‹ä¸€é¡µ</button>
            `;
        }

        // åŠ è½½ç”¨æˆ·è®°å½•
        async function loadRecords(page = 0) {
            currentRecordsPage = page;
            const loadingDiv = document.getElementById('recordsLoading');
            const errorDiv = document.getElementById('recordsError');
            const tableDiv = document.getElementById('recordsTable');
            const paginationDiv = document.getElementById('recordsPagination');

            loadingDiv.classList.remove('hidden');
            errorDiv.classList.add('hidden');
            tableDiv.innerHTML = '';
            paginationDiv.innerHTML = '';

            try {
                const offset = page * pageSize;
                const response = await fetch(`${API_BASE}/admin/records?limit=${pageSize}&offset=${offset}`, {
                    headers: {
                        'X-Admin-Password': adminPassword
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    renderRecordsTable(data.data, data.total);
                } else {
                    errorDiv.textContent = data.error || 'åŠ è½½å¤±è´¥';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                errorDiv.textContent = 'åŠ è½½å¤±è´¥: ' + error.message;
                errorDiv.classList.remove('hidden');
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }

        // æ¸²æŸ“ç”¨æˆ·è®°å½•è¡¨æ ¼
        function renderRecordsTable(records, total) {
            const tableDiv = document.getElementById('recordsTable');
            const paginationDiv = document.getElementById('recordsPagination');

            let html = '<table><thead><tr>';
            html += '<th>ID</th><th>é‚€è¯·ç </th><th>å‡ºç”Ÿæ—¥æœŸ</th><th>æ€§åˆ«</th><th>åŸå¸‚</th><th>æäº¤æ—¶é—´</th><th>æ“ä½œ</th>';
            html += '</tr></thead><tbody>';

            records.forEach(record => {
                html += '<tr>';
                html += `<td>${record.id}</td>`;
                html += `<td><strong>${record.invitation_code}</strong></td>`;
                html += `<td>${record.birth_date}</td>`;
                html += `<td>${record.gender || '-'}</td>`;
                html += `<td>${record.city || '-'}</td>`;
                html += `<td>${new Date(record.created_at).toLocaleString('zh-CN')}</td>`;
                html += `<td><button class="btn btn-info" onclick="viewRecordDetail(${record.id})">æŸ¥çœ‹è¯¦æƒ…</button></td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableDiv.innerHTML = html;

            // åˆ†é¡µ
            const totalPages = Math.ceil(total / pageSize);
            paginationDiv.innerHTML = `
                <button ${currentRecordsPage === 0 ? 'disabled' : ''} onclick="loadRecords(${currentRecordsPage - 1})">ä¸Šä¸€é¡µ</button>
                <div class="page-info">ç¬¬ ${currentRecordsPage + 1} é¡µ / å…± ${totalPages} é¡µ (æ€»è®¡ ${total} æ¡)</div>
                <button ${currentRecordsPage >= totalPages - 1 ? 'disabled' : ''} onclick="loadRecords(${currentRecordsPage + 1})">ä¸‹ä¸€é¡µ</button>
            `;
        }

        // æŸ¥çœ‹è®°å½•è¯¦æƒ…
        async function viewRecordDetail(id) {
            const modal = document.getElementById('detailModal');
            const content = document.getElementById('detailContent');

            content.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            modal.classList.add('active');

            try {
                const response = await fetch(`${API_BASE}/admin/records/${id}`, {
                    headers: {
                        'X-Admin-Password': adminPassword
                    }
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    const record = data.data;
                    let html = '';

                    html += '<div class="detail-section">';
                    html += '<h3>åŸºæœ¬ä¿¡æ¯</h3>';
                    html += `<p><strong>è®°å½•ID:</strong> ${record.id}</p>`;
                    html += `<p><strong>é‚€è¯·ç :</strong> ${record.invitation_code}</p>`;
                    html += `<p><strong>å‡ºç”Ÿæ—¥æœŸ:</strong> ${record.birth_date}</p>`;
                    html += `<p><strong>æ€§åˆ«:</strong> ${record.gender || '-'}</p>`;
                    html += `<p><strong>åŸå¸‚:</strong> ${record.city || '-'}</p>`;
                    html += `<p><strong>ç»åº¦:</strong> ${record.longitude || '-'}</p>`;
                    html += `<p><strong>æ—¶åŒº:</strong> ${record.timezone || '-'}</p>`;
                    html += `<p><strong>æäº¤æ—¶é—´:</strong> ${new Date(record.created_at).toLocaleString('zh-CN')}</p>`;
                    html += '</div>';

                    if (record.bazi_result) {
                        html += '<div class="detail-section">';
                        html += '<h3>å…«å­—ç»“æœ</h3>';
                        html += `<pre>${JSON.stringify(record.bazi_result, null, 2)}</pre>`;
                        html += '</div>';
                    }

                    if (record.ziwei_result) {
                        html += '<div class="detail-section">';
                        html += '<h3>ç´«å¾®æ–—æ•°ç»“æœ</h3>';
                        html += `<pre>${JSON.stringify(record.ziwei_result, null, 2)}</pre>`;
                        html += '</div>';
                    }

                    if (record.analysis_result) {
                        html += '<div class="detail-section">';
                        html += '<h3>åˆ†æç»“æœ</h3>';
                        html += `<pre>${JSON.stringify(record.analysis_result, null, 2)}</pre>`;
                        html += '</div>';
                    }

                    content.innerHTML = html;
                } else {
                    content.innerHTML = `<div class="error-message">${data.error || 'åŠ è½½å¤±è´¥'}</div>`;
                }
            } catch (error) {
                content.innerHTML = `<div class="error-message">åŠ è½½å¤±è´¥: ${error.message}</div>`;
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        document.getElementById('detailModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // å›è½¦ç™»å½•
        document.getElementById('passwordInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                login();
            }
        });
    </script>
</body>

</html>